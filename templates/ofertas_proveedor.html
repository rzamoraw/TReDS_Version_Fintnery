{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
  <h2>Ofertas recibidas ‚Äî Factura {{ factura.folio }}</h2>
  <p>
  <strong>Monto:</strong> ${{ '{:,.0f}'.format(factura.monto) }} |
  <strong>Vencimiento:</strong> {{ factura.fecha_vencimiento }}
</p>

{% if request.query_params.msg == "oferta_adjudicada" %}
  <div class="alert alert-success mt-3">
    üéâ Oferta adjudicada correctamente. Pronto recibir√°s el confirming.
  </div>
{% endif %}

{% if bloqueado %}
  <div class="alert alert-info mt-2">
    Esta factura ya fue <strong>adjudicada</strong>. No es posible adjudicar otra oferta.
  </div>
{% endif %}

<table class="table table-bordered table-hover mt-4 bg-white">
  <thead class="table-light">
    <tr>
      <th>Fondo</th>
      <th>Financiador</th>
      <th>Tasa total mensual (%)</th>
      <th>D√≠as anticipaci√≥n</th>
      <th>Comisi√≥n flat ($)</th>
      <th><strong>Precio cesi√≥n ($)</strong></th>
      <th>Acci√≥n</th>
    </tr>
  </thead>
  <tbody>
    {% for oferta in ofertas %}
      <tr>
        <td>{{ oferta.financiador.fondo.nombre if oferta.financiador and oferta.financiador.fondo else '‚Äî' }}</td>
        <td>{{ oferta.financiador.nombre if oferta.financiador else '‚Äî' }}</td>
        <td>
          {% if oferta.tasa_interes is not none %}
            {{ '%.2f' % (oferta.tasa_interes * 100) }} %
          {% else %}
            N/D
          {% endif %}
        </td>
        <td>{{ oferta.dias_anticipacion }}</td>
        <td>${{ '{:,.0f}'.format(oferta.comision_flat or 0) }}</td>
        <td><strong>${{ '{:,.0f}'.format(oferta.precio_cesion or 0) }}</strong></td>
        <td>
          {% if bloqueado %}
            {% if oferta.estado == "Adjudicada" %}
              <span class="badge bg-success">Adjudicada</span>
            {% else %}
              <span class="badge bg-secondary">No adjudicada</span>
            {% endif %}
          {% else %}
            <form method="post" action="/proveedor/aceptar-oferta/{{ oferta.id }}">
              <button class="btn btn-sm btn-success">Adjudicar</button>
            </form>
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
    </div>
  {% else %}
    <div class="alert alert-info mt-4">
      No se han recibido ofertas a√∫n para esta factura.
    </div>
  {% endif %}

  <a href="/proveedor" class="btn btn-outline-secondary mt-3">‚Üê Volver a mis facturas</a>
</div>
{% endblock %}